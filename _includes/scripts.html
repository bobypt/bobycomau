<!-- Bootstrap Core JavaScript -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>

<!-- Mermaid.js for diagrams -->
<script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
<script>
  // Convert Kramdown's language-mermaid code blocks to mermaid class
  (function() {
    function initMermaid() {
      // Find all code blocks with language-mermaid
      const mermaidCodeBlocks = document.querySelectorAll('code.language-mermaid');
      mermaidCodeBlocks.forEach(function(block) {
        // Get the parent pre element
        const pre = block.parentElement;
        if (pre && pre.tagName === 'PRE') {
          // Move the content to the pre element and add mermaid class
          pre.className = 'mermaid';
          pre.textContent = block.textContent;
          // Remove the code element
          block.remove();
        }
      });
      
      // Initialize Mermaid (don't auto-start, we'll run manually)
      if (typeof mermaid !== 'undefined') {
        mermaid.initialize({ startOnLoad: false, theme: 'default' });
        // Run Mermaid to render all diagrams
        mermaid.run().then(function() {
          // Apply animation styles after rendering
          setTimeout(function() {
            const mermaidSvgs = document.querySelectorAll('.mermaid svg');
            mermaidSvgs.forEach(function(svg) {
              // Ensure arrow markers are white
              const markers = svg.querySelectorAll('marker path, marker polygon');
              markers.forEach(function(marker) {
                marker.setAttribute('fill', '#ffffff');
                marker.setAttribute('stroke', '#ffffff');
              });
              
              // Apply animation to paths and add moving dots
              const paths = svg.querySelectorAll('.edgePath path');
              paths.forEach(function(path, index) {
                path.style.stroke = '#ffffff';
                path.style.strokeDasharray = '8,4';
                path.style.animation = 'dash 15s linear infinite';
                
                // Create a moving dot for this path
                const pathId = path.getAttribute('id') || 'mermaid-path-' + Date.now() + '-' + index;
                if (!path.getAttribute('id')) {
                  path.setAttribute('id', pathId);
                }
                
                // Create circle for the moving dot
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('class', 'moving-dot');
                circle.setAttribute('r', '4');
                circle.setAttribute('fill', '#ffffff');
                circle.style.filter = 'drop-shadow(0 0 2px rgba(255,255,255,0.8))';
                
                // Create animateMotion element
                const animateMotion = document.createElementNS('http://www.w3.org/2000/svg', 'animateMotion');
                animateMotion.setAttribute('dur', '3s');
                animateMotion.setAttribute('repeatCount', 'indefinite');
                animateMotion.setAttribute('calcMode', 'linear');
                // Stagger animation start times for visual effect
                animateMotion.setAttribute('begin', (index * 0.5) + 's');
                
                const mpath = document.createElementNS('http://www.w3.org/2000/svg', 'mpath');
                mpath.setAttributeNS('http://www.w3.org/1999/xlink', 'href', '#' + pathId);
                animateMotion.appendChild(mpath);
                circle.appendChild(animateMotion);
                
                // Add circle to the edgePath group
                const edgePath = path.parentElement;
                if (edgePath) {
                  edgePath.appendChild(circle);
                }
              });
            });
          }, 100);
        });
      }
    }
    
    // Run when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initMermaid);
    } else {
      // DOM already loaded, run immediately
      setTimeout(initMermaid, 0);
    }
  })();
</script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-44430522-1', 'auto');
  ga('send', 'pageview');

</script>
